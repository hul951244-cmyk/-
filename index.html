<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>AI语音自然度与停顿词察觉 - 预实验</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
    h2 { margin-top: 30px; }
    label { display: block; margin: 8px 0 4px; }
    input[type=number], select, textarea { width: 300px; padding: 6px; }
    .scale label { display: block; margin-bottom: 6px; }
    .audio-block { margin: 20px 0; }
    button { padding: 10px 20px; margin-top: 20px; cursor: pointer; }
    .text-box { background: #f9f9f9; padding: 10px; border-radius: 6px; margin-top: 10px; white-space: pre-wrap; }
</style>
</head>
<body>

<h1>AI语音自然度与停顿词察觉 - 预实验</h1>
<p>请您佩戴耳机，在安静环境下完成本实验。您将听两段不同版本的 AI 订餐对话，请按顺序听并完成每段后的问卷。</p>
<hr>

<form id="surveyForm">
<div id="experiment"></div>

<h2>基本信息</h2>
<label>年龄：
    <input type="number" name="age" required>
</label>
<label>性别：
    <select name="gender" required>
        <option value="">请选择</option>
        <option value="男">男</option>
        <option value="女">女</option>
        <option value="其他">其他</option>
    </select>
</label>
<label>AI 使用经验（1=从未使用，5=非常熟练）：
    <input type="number" name="ai_experience" min="1" max="5" required>
</label>

<button type="submit">提交</button>
</form>

<script>
// Google Apps Script URL
const scriptURL = "https://script.google.com/macros/s/AKfycby4ETHX5jCbMP-Pr6T-YRvEUIVK4OoegFTYi3kTxkCJsYAj-qurPw7yKePEImxiZzH_kw/exec";

// 对话文本
const dialogues = {
    no_pause: `顾客：你好，请问可以帮我订餐吗？
AI：当然可以，请问您打算什么时候来？
顾客：下周三晚上。
AI：好的，您一共几位呢？
顾客：四位。
AI：好的，那您希望几点钟到？
顾客：六点钟。
AI：好的，请稍等，我帮您查一下。有位置的。那我帮您预订好啦。
顾客：好的，谢谢。
AI：不客气，我们下周三见。`,

    pause: `顾客：你好，请问可以帮我订餐吗？
AI：嗯…当然可以，请问您打算什么时候来？
顾客：下周三晚上。
AI：好的，呃…您一共几位呢？
顾客：四位。
AI：好的，嗯…那您希望几点钟到？
顾客：六点钟。
AI：那个…好的，请稍等，我帮您查一下…呃…有位置的。那我帮您预订好啦。
顾客：好的，谢谢。
AI：不客气，我们下周三见。`
};

// 随机化顺序
let versions = ["no_pause", "pause"];
versions = versions.sort(() => Math.random() - 0.5);
const orderLabel = versions[0] === "pause" ? "pause-first" : "no-pause-first";

// 动态生成问卷
const container = document.getElementById("experiment");
versions.forEach((version, idx) => {
    container.innerHTML += `
        <h2>音频 ${idx + 1}</h2>
        <div class="audio-block">
            <audio controls required>
                <source src="${version}.mp3" type="audio/mpeg">
                您的浏览器不支持音频播放。
            </audio>
        </div>
        <div class="text-box">${dialogues[version]}</div>

        <h3>自然度感知量表（1=非常不同意，7=非常同意）</h3>
        <div class="scale">
            <label>这个语音听起来很自然：
                <input type="number" name="audio${idx+1}_score1" min="1" max="7" required>
            </label>
            <label>这个语音听起来流畅：
                <input type="number" name="audio${idx+1}_score2" min="1" max="7" required>
            </label>
            <label>这个语音听起来接近真人：
                <input type="number" name="audio${idx+1}_score3" min="1" max="7" required>
            </label>
        </div>

        <h3>停顿词察觉度</h3>
        <label>你是否察觉到停顿词？
            <select name="pause_detected${idx+1}" required>
                <option value="">请选择</option>
                <option value="是">是</option>
                <option value="否">否</option>
            </select>
        </label>
        <label>如果有，请描述：
            <textarea name="pause_comment${idx+1}"></textarea>
        </label>
        <hr>
    `;
});

// 提交表单（安全写法）
document.getElementById("surveyForm").addEventListener("submit", function(e) {
    e.preventDefault();

    // 1. 收集所有表单字段
    let data = Object.fromEntries(new FormData(this).entries());

    // 2. 加上实验元数据
    data.timestamp = new Date().toISOString();
    data.order = orderLabel;
    data.audio1_type = versions[0];
    data.audio2_type = versions[1];

    // 3. 发送到 Google Apps Script
    fetch(scriptURL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    }).then(() => {
        alert("提交成功！感谢您的参与。");
        window.location.reload();
    }).catch(() => {
        alert("提交失败，请重试。");
    });
});
</script>

</body>
</html>

